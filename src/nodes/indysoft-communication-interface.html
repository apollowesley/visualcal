<!-- indysoft-communication-interface -->
<script type="text/x-red" data-template-name="indysoft-communication-interface">
  <div class="form-row">
    <label for="node-config-input-name"><i class="fa fa-tag" /><span data-i18n="node-red:common.label.name" /></label>
    <input type="text" id="node-config-input-name" data-i18n="[placeholder]node-red:common.label.name">
  </div>
  <div class="form-row">
    <label for="node-config-input-configType"><i class="fa fa-tag"></i> Type</label>
    <select id="node-config-input-configType" style="width:125px !important">
      <option value="serial" selected>Serial Port</option>
      <option value="prologixUsb">Prologix GPIB USB</option>
      <option value="prologixTcp">Prologix GPIB TCP</option>
    </select>
  </div>
  <div class="form-row" id="serial-config-row">
    <label for="node-config-input-serialConfigNodeId"><i class="fa fa-tag"></i> Serial port</label>
    <input type="text" id="node-config-input-serialConfigNodeId" style="display: inline-block; width: auto; vertical-align: top;">
  </div>
  <div class="form-row" id="prologix-gpib-usb-config-row">
    <label for="node-config-input-prologixGpibUsbConfigNodeId"><i class="fa fa-tag"></i> Prologix GPIB TCP</label>
    <input type="text" id="node-config-input-prologixGpibUsbConfigNodeId" style="display: inline-block; width: auto; vertical-align: top;">
  </div>
  <div class="form-row" id="prologix-gpib-tcp-config-row">
    <label for="node-config-input-prologixGpibTcpConfigNodeId"><i class="fa fa-tag"></i> Prologix GPIB USB</label>
    <input type="text" id="node-config-input-prologixGpibTcpConfigNodeId" style="display: inline-block; width: auto; vertical-align: top;">
  </div>

  <div class="form-row" id="gpib-address-row">
    <label for="node-config-input-gpibAddress"><i class="fa fa-tag"></i> GPIB Address</label>
    <input type="text" id="node-config-input-gpibAddress" style="display: inline-block; width: auto; vertical-align: top;">
  </div>
</script>

<script type="text/x-red" data-help-name="indysoft-communication-interface">
  <p>Configuration of a communication interface</p>
</script>

<script type="text/javascript">

  RED.nodes.registerType('indysoft-communication-interface', {
    category: 'config',
    defaults: {
      name: { value: '', required: true },
      configType: { value: 'serial', required: true },
      serialConfigNodeId: { value: '', type: 'serial-port-config', required: false },
      prologixGpibUsbConfigNodeId: { value: '', type: 'prologix-gpib-usb-config', required: false },
      prologixGpibTcpConfigNodeId: { value: '', type: 'prologix-gpib-tcp-config', required: false },
      gpibAddress: { value: 0, validate: RED.validators.number() }
    },
    label: function() {
      if (this.name) return this.name;
      const curConfigType = $('#node-config-input-configType').val();
      console.info/(curConfigType);
      switch (curConfigType) {
        case 'serial':
          return 'Serial Port';
          break;
        case 'prologixUsb':
          return 'Prologix GPIB USB';
          break;
        case 'prologixTcp':
          return 'Prologix GPIB TCP';
          break;
      }
      return 'Communication Interface Configuration';
    },
    labelStyle: function() {
      return this.name ? 'node_label_italic' : '';
    },
    oneditprepare: function() {
      const configTypeSelect = $('#node-config-input-configType');
      const serialConfigRow = $('#serial-config-row');
      const prologixGpibUsbConfigRow = $('#prologix-gpib-usb-config-row');
      const prologixGpibTcpConfigRow = $('#prologix-gpib-tcp-config-row');
      const icsConfigRow = $('#ics-config-row');
      const gpibAddressRow = $('#gpib-address-row');

      configTypeSelect.on('change', () => {
        const curConfigType = $('#node-config-input-configType').val();
        switch (curConfigType) {
          case 'serial':
            serialConfigRow.show();
            prologixGpibUsbConfigRow.hide();
            prologixGpibTcpConfigRow.hide();
            icsConfigRow.hide();
            gpibAddressRow.hide();
            break;
          case 'prologixUsb':
            serialConfigRow.hide();
            prologixGpibUsbConfigRow.show();
            prologixGpibTcpConfigRow.hide();
            icsConfigRow.hide();
            gpibAddressRow.show();
            break;
          case 'prologixTcp':
            serialConfigRow.hide();
            prologixGpibUsbConfigRow.hide();
            prologixGpibTcpConfigRow.show();
            icsConfigRow.hide();
            gpibAddressRow.show();
            break;
        }
      });

      configTypeSelect.change();
    }
    // oneditsave: function() {
    //   const curConfigType = $('#node-input-configType').val();
    //   this.configType = curConfigType;
    //   switch (curConfigType) {
    //     case 'serial':
    //       this.serialConfigNodeId = $('#node-config-input-serialConfigNodeId');
    //       break;
    //     case 'prologixUsb':
    //     this.prologixGpibUsbConfigNodeId = $('#node-config-input-prologixGpibUsbConfigNodeId');
    //       break;
    //     case 'prologixTcp':
    //       this.prologixGpibTcpConfigNodeId = $('#node-config-input-prologixGpibTcpConfigNodeId');
    //       break;
    //   }
    // }
  });

</script>
